var arr =[
    {
    'q': "تحتوي صفحة Header. php  علي الصورة banner  التي تعرض اعلى كل صفحات الموقع و الارتباطات التشعبية بجميع صفحات الموقع",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "a",
    'url': "https://www.youtube.com/embed/ZjbN-Pdq9P0"
}
,{
    'q': "الامر الذي يكتب بلغة الترميز HTML  يطلق عليه   . Tag",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "a",
    'url': "https://www.youtube.com/embed/JOaZjXoY0B"
}
,{
    'q': "المعلومات التي ستعرض على مستعرض الانترنت تكتب بين  Title.",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "b",
    'url': "https://www.youtube.com/embed/6XqmOTwZC_0"
}
,{
    'q': "عنوان صفحة الويب تكتب بين Title.",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "a",
    'url': " https://www.youtube.com/embed/6XqmOTwZC_0"
}
,{
    'q': "في لغة الترميز Html  بعض ال Tags ليس لها اغلاق او نهاية مثل  < BR >",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "a",
    'url': " https://www.youtube.com/embed/6XqmOTwZC_0"
}
,{
    'q': "لحفظ ملف كود لغة الترميز Html يجب ان يكون امتداده.doc   .",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "b",
    'url': " https://www.youtube.com/embed/6XqmOTwZC_0"
}
,{
    'q': "من مكونات الشاشة الرئيسية لبرنامج Web Expression  جميع ما سبق ",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "a",
    'url': "https://www.youtube.com/embed/ZjbN-Pdq9P0"
}
,{
    'q': "لترك مسافة واحدة بين اكواد    Html نستخدم الكود &",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "b",
    'url': " https://www.youtube.com/embed/6XqmOTwZC_0"
}
,{
    'q': "المتغيرات  مخزن في الذاكرة يحدد له اسم ونوع ويخصص له قيمه وتتغير قيمته اثناء سير البرنامج",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "a",
    'url': "https://www.youtube.com/embed/GnEjTvD-x-Y"
}
,{
    'q': "علامة التخصيص هي =  ",
    'ans':['true' , 'false'],
    'type_of_question':'tf',
    'coanswer': "a",
    'url': "https://www.youtube.com/embed/GnEjTvD-x-Y"
}

// mul chose question
,{
    'q': "تحتوي صفحة........................ علي الصورة banner  التي تعرض اعلى كل صفحات الموقع و الارتباطات التشعبية بجميع صفحات الموقع ",
    'ans':['صفحة الاتصال connection. Php ' , 'صفحة Header. php  ','صفحة ادخال المحتوى Add_term.php','صفحة ادخال البيانات Add_data.php'],
    'type_of_question':'mc',
    'coanswer': "b",
    'url': "https://www.youtube.com/embed/ZjbN-Pdq9P0"
}
,{
    'q': "الامر الذي يكتب بلغة الترميز HTML  يطلق عليه .................",
    'ans':['Code','Head','Tag','body'],
    'type_of_question':'mc',
    'coanswer': "c",
    
'url': "https://www.youtube.com/embed/JOaZjXoY0B"     
}
,{
    'q': "المعلومات التي ستعرض على مستعرض الانترنت تكتب بين .........................",
    'ans':['Body' , 'Title','Head','meta'],
    'type_of_question':'mc',
    'coanswer': "a",
    
'url': "https://www.youtube.com/embed/6XqmOTwZC_0"        
}
,{
    'q': "عنوان صفحة الويب تكتب بين .............",
    'ans':['Body' , 'Title','Head','meta'],
    'type_of_question':'mc',
    'coanswer': "b",
    
'url': " https://www.youtube.com/embed/6XqmOTwZC_0"
}
,{
    'q': "في لغة الترميز Html  بعض ال Tags ليس لها اغلاق او نهاية مثل .......",
    'ans':['< Title >' , '< Head >',' < BR > ','<BODY>'],
    'type_of_question':'mc',
    'coanswer': "c",
    
'url': " https://www.youtube.com/embed/6XqmOTwZC_0"
}
,{
    'q': "لحفظ ملف كود لغة الترميز Html يجب ان يكون امتداده .........",
    'ans':['.css' , '.doc','. Html','.xlxs'],
    'type_of_question':'mc',
    'coanswer': "c",
    
'url': " https://www.youtube.com/embed/6XqmOTwZC_0"
}
,{
    'q': "من مكونات الشاشة الرئيسية لبرنامج Web Expression...............",
    'ans':['شريط القوائم  Menu bar' , 'نافذة صندوق الأدوات','جميع ما سبق','روابط التنقل links'],
    'type_of_question':'mc',
    'coanswer': "c",
    'url': "https://www.youtube.com/embed/ZjbN-Pdq9P0"   
}
,{
    'q': "لترك مسافة واحدة بين اكواد  Html نستخدم الكود ..............",
    'ans':['nbsp &' , '&','nbsp','//'],
    'type_of_question':'mc',
    'coanswer': "a",
    'url': " https://www.youtube.com/embed/6XqmOTwZC_0"   
}
,{
    'q': "............. مخزن في الذاكرة يحدد له اسم ونوع ويخصص له قيمه وتتغير قيمته اثناء سير البرنامج",
    'ans':['جملة التخصيص' , 'المتغيرات ','الثوابت','القيم'],
    'type_of_question':'mc',
    'coanswer': "b",
    'url': "https://www.youtube.com/embed/GnEjTvD-x-Y"
}
,{
    'q': "علامة التخصيص هي ......... ",
    'ans':['+' , '=','-','*'],
    'type_of_question':'mc',
    'coanswer': "b",
    'url': "https://www.youtube.com/embed/GnEjTvD-x-Y"
}


];



var html_lang = document.getElementsByTagName('html');
var que_mark = document.getElementById('que-mark');
var answers;

if (html_lang[0].getAttribute("lang") == 'Ar') {
answers = ["صح","خطاء"];
que_mark.style.right ="-10%";
}else{
    answers = ["true","false"];
    que_mark.style.left = "-10%" ;
}

var question_span = document.getElementById('question');

var next_btn = document.getElementById('next-btn');
var prev_btn = document.getElementById('prev-btn');
var question_selector = document.getElementById('question_selector');
var div_box_buttons = document.getElementById('box_buttons');
var answer_div_inputs = document.getElementById('answer_div');


var user_answer_array = [];
var inputs_array= [] ;
var box_buttons="";
var exam_time_in_secand = 3600;// 10 minutes 
let quection_counter = 0;
var start_date = "";
var interval ;

function load_frist_question() {
    start_date =  get_time();
    color_box();
    load_side_boxes();
    load_question(0);
    interval = setInterval(setTime, 1000);
    next_btn.disabled= false;
    prev_btn.disabled= true;
}

function load_side_boxes() {
    arr.forEach((element,index) => {
        div_box_buttons.innerHTML += `<button onclick='side_button_action(this.value)' value='${index}'>${index+1}</button>`;
        user_answer_array[index]= -1;
    });
    box_buttons = document.querySelectorAll('#box_buttons button')
}

function next_question(){
    save_answer();
    quection_counter++;
    load_question(quection_counter);
    nextCheck();
    if (quection_counter == 0) {   
        
        prev_btn.disabled= true;
    }else{
        prev_btn.disabled= false;

    }
    next_btn.disabled= false;
    if (quection_counter == arr.length-1) {   
        
        prev_btn.disabled= false;
        next_btn.disabled= true;
    }
    color_box();

}

function previous_question(){
    save_answer();
    quection_counter = quection_counter-1;
    load_question(quection_counter);
    pevCheck();
    next_btn.disabled= false;
    if (quection_counter == 0) {   
        next_btn.disabled= false;
        prev_btn.disabled= true;
    }
    color_box();
}

function load_question(question_number){

    // save_answer(question_number-1);
    quection_counter = question_number;
    prev_btn.disabled= false;
    next_btn.disabled= false;

   
    question_span.innerHTML="";
    answer_div_inputs.innerHTML = "";
    arr.forEach((element,index)=>{
        if (question_number == index) {
            question_selector.innerHTML = element["q"];
            element["ans"].forEach( (inside_element,inside_index) =>{
                if ( element["ans"].length == 4) {
                answer_div_inputs.innerHTML +=`<div><input type="radio" name="q-answers" id="q${inside_index}" value="${String.fromCharCode(97+inside_index)}" aria-details ="multiple-question"> <label for="q${inside_index}" id="lable-a">${inside_element}</label></div>`; 
               
                }else{
                    answer_div_inputs.innerHTML +=`<div><input type="radio" name="q-answers" id="q${inside_index}" value="${String.fromCharCode(97+inside_index)}" aria-details ="tf-question"> <label for="q${inside_index}" id="lable-a">${answers[inside_index]}</label></div>`; 
                    inputs_array = document.querySelectorAll(".answers div input");
                }
    
            })
            inputs_array = document.querySelectorAll(".answers div input");
        }
    })
    if (question_number ==0) {
        prev_btn.disabled= true;
    }
    if (question_number == arr.length-1) {
        next_btn.disabled= true;
    }
    var qnumber = parseInt(question_number)+ 1;
   
    if (html_lang[0].getAttribute("lang") == 'Ar') {
        question_span.innerHTML = ` السؤال(${qnumber}) `;
        
    }else{
            
        question_span.innerHTML = ` Quetion(${qnumber}) `;

        }
    color_box();

}

function side_button_action(num_of_question) {
    save_answer();
    load_question(num_of_question); 
    
}

function save_answer() {
    inputs_array.forEach(element=>{
        if (element.checked) {
            user_answer_array[quection_counter] = element.value;
        }
    });
    unchecked_inputs();
}

function unchecked_inputs() {
    inputs_array.forEach(element=>{
        if (element.checked) {
         element.checked = false;
        }
    });
}

function color_box() {
 user_answer_array.forEach((element,index) =>{
    if (element !=-1) {
        box_buttons[index].style.backgroundColor  = "var(--main-color)";
        box_buttons[index].style.color  = "var(--whait-color)";
    }
 });
}

function nextCheck() {   
     //rechecks answers when revisiting them
     if (inputs_array.length == 4) {
        switch (user_answer_array[quection_counter]) {
            case "a":
                inputs_array[0].checked = true;
                break;
            case "b":
                inputs_array[1].checked = true;
                break;
            case "c":
                inputs_array[2].checked = true;
                break;
            case "d":
                inputs_array[3].checked = true;
        }
     } else {
        switch (user_answer_array[quection_counter]) {
            case "a":
                inputs_array[0].checked = true;
                break;
            case "b":
                inputs_array[1].checked = true;
                break;
        }
        
     }
    //rechecks answers when revisiting them
   

}

function pevCheck() {       //rechecks answers when revisiting them
    if (inputs_array.length == 4) {
    switch (user_answer_array[quection_counter]) {
        case "a":
            inputs_array[0].checked = true;
            break;
        case "b":
            inputs_array[1].checked = true;
            break;
        case "c":
            inputs_array[2].checked = true;
            break;
        case "d":
            inputs_array[3].checked = true;
    }
}else{
    switch (user_answer_array[quection_counter]) {
        case "a":
            inputs_array[0].checked = true;
            break;
        case "b":
            inputs_array[1].checked = true;
            break;
    }
}
}

function finshed_button() {
    save_answer();
    clearInterval(interval);
   var type = get_number_of_question_and_type();
   var score = calc_score();

    var time_tacken_en = pad(parseInt((exam_time_in_secand - totalSeconds) / 60)) +" min " +pad((exam_time_in_secand-totalSeconds) % 60)+" sec";

    var time_tacken_ar = pad(parseInt((exam_time_in_secand-totalSeconds) / 60)) +" دقيقة " +pad((exam_time_in_secand-totalSeconds) % 60)+" ثانية";

    let exam_data = {
        'quection_array':arr,
        "number_tf_question":type["true_false"],
        "number_mc_question":type["multiple_choices"],
        "correct_tf_question":score["correcr_tf"],
        "correct_mc_question":score["correcr_mc"],

        "total_score":score["total"],
        "unsolived_question":score["unsolived_q"],
        "user_answer":user_answer_array,
        "time_tacken_en":time_tacken_en,
        "time_tacken_ar":time_tacken_ar,
        "start_date" :start_date,
        "finshed_date" :get_time(),
        "number_of_attends" :sessionStorage.getItem("exam_data")? 2:1,

    }

    sessionStorage.setItem("exam_data", JSON.stringify(exam_data));  
   

    if (html_lang[0].getAttribute("lang") == 'Ar') {
        window.location.href = "result-exam-Ar.html";
        }
        else{
            window.location.href = "result-exam-En.html";
        }
        
}

function get_number_of_question_and_type() {
    var tf_question = 0;
    var mc_question = 0;
    arr.forEach((element)=>{
        if (element["type_of_question"]=="tf") {
            tf_question++;
        }
        if (element["type_of_question"] == "mc") {
            mc_question++;
        }
    });

    return {"true_false":tf_question,"multiple_choices":mc_question};
}

function calc_score() {
    var total = 0 ;
    var unsolived_q =0 ;
    var correcr_tf = 0;
    var correcr_mc = 0;
    arr.forEach((element,index)=>{
        if (user_answer_array[index]!= -1) {
            if (user_answer_array[index] == element['coanswer']) {
                total++;
                if (element['type_of_question']=="tf") {
                    correcr_tf++;
                }else{
                    correcr_mc++;
                }

            }
        } else {
            unsolived_q ++;
        }
    });

    return {"total":total,"unsolived_q":unsolived_q,"correcr_tf":correcr_tf,"correcr_mc":correcr_mc};

}

function  get_time() {
    return new Date().toUTCString("ar_EG");
}


/**
 * 
 * This is timer
 * 
**/

var minutesLabel = document.getElementById("minutes");
var secondsLabel = document.getElementById("seconds");
var totalSeconds = exam_time_in_secand;
minutesLabel.innerHTML="60";
secondsLabel.innerHTML="00";
function setTime() {
  --totalSeconds;
  secondsLabel.innerHTML = pad(totalSeconds % 60);
  minutesLabel.innerHTML = pad(parseInt(totalSeconds / 60));

  if (totalSeconds == 0) {
    finshed_button();
  }
}

function pad(val) {
  var valString = val + "";
  if (valString.length < 2) {
    return "0" + valString;
  } else {
    return valString;
  }
}


